<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Crypto Analyst Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 p-4">
  <h1 class="text-3xl font-bold mb-4 text-center">AI Crypto Analyst Dashboard</h1>
  <div class="flex justify-center mb-4">
    <button id="refreshBtn" class="px-4 py-2 bg-blue-600 text-white rounded">Refresh</button>
  </div>
  <div id="tracker" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>

  <script>
    const coins = [
      { id: 'crypto-com-chain', symbol: 'CRO', name: 'Cronos' },
      { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin' },
      { id: 'ripple', symbol: 'XRP', name: 'XRP' },
      { id: 'ethereum', symbol: 'ETH', name: 'Ethereum' },
      { id: 'cardano', symbol: 'ADA', name: 'Cardano' },
      { id: 'hedera-hashgraph', symbol: 'HBAR', name: 'Hedera' },
    ];

    const charts = {};
    const history = {};

    async function fetchFearGreed() {
      try {
        const res = await fetch('https://api.alternative.me/fng/?format=json');
        const data = await res.json();
        return data.data[0].value;
      } catch (e) {
        return 'N/A';
      }
    }

    function generatePredictions(current) {
      const predictions = [];
      let price = parseFloat(current);
      for (let i = 0; i < 24; i++) {
        price = price * (1 + (Math.random() - 0.5) / 50); // +/-1%
        predictions.push(price);
      }
      return predictions;
    }

    function advise(current, predictions) {
      const c = parseFloat(current);
      const next = predictions[0];
      if (next > c * 1.01) return 'Buy';
      if (next < c * 0.99) return 'Sell';
      return 'Hold';
    }

    async function fetchData() {
      const ids = coins.map(c => c.id).join('%2C');
      const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}`;
      const res = await fetch(url);
      const data = await res.json();
      const fng = await fetchFearGreed();
      render(data, fng);
    }

    function render(data, fearGreed) {
      const container = document.getElementById('tracker');
      container.innerHTML = '';
      data.forEach(info => {
        const card = document.createElement('div');
        card.className = 'bg-white shadow p-4 rounded';
        const price = info.current_price.toFixed(4);
        const change = info.price_change_percentage_24h.toFixed(2);
        const predictions = generatePredictions(price);
        const advice = advise(price, predictions);
        const rows = predictions
          .map((p, i) => `<tr><td class="pr-2">${i + 1}h</td><td>$${p.toFixed(4)}</td></tr>`) 
          .join('');
        card.innerHTML = `
          <h2 class="text-xl font-semibold mb-2 flex items-center">
            <img src="${info.image}" alt="${info.symbol}" class="w-6 h-6 mr-2"/>
            ${info.name} (${info.symbol.toUpperCase()})
          </h2>
          <p>Price: $${price}</p>
          <p>Market Cap: $${Number(info.market_cap).toLocaleString()}</p>
          <p class="${change >= 0 ? 'text-green-600' : 'text-red-600'}">24h Change: ${change}%</p>
          <p>Fear &amp; Greed Index: ${fearGreed}</p>
          <p>Advice: <span class="font-semibold">${advice}</span></p>
          <canvas id="chart-${info.id}" height="100"></canvas>
          <div class="overflow-y-auto h-32 mt-2">
            <table class="text-sm w-full">
              <thead><tr><th class="text-left">Hr</th><th class="text-left">Predicted</th></tr></thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        `;
        container.appendChild(card);

        if (!history[info.id]) history[info.id] = [];
        history[info.id].push(info.current_price);
        if (history[info.id].length > 60) history[info.id].shift();

        let chart = charts[info.id];
        if (!chart) {
          const ctx = document.getElementById(`chart-${info.id}`).getContext('2d');
          chart = charts[info.id] = new Chart(ctx, {
            type: 'line',
            data: {
              labels: history[info.id].map((_, i) => i),
              datasets: [{
                label: 'Live Price',
                data: history[info.id],
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
              }]
            },
            options: { animation: false, scales: { x: { display: false } } }
          });
        } else {
          chart.data.labels = history[info.id].map((_, i) => i);
          chart.data.datasets[0].data = history[info.id];
          chart.update();
        }
      });
    }

    fetchData();
    setInterval(fetchData, 60000); // refresh every minute
    document.getElementById('refreshBtn').addEventListener('click', fetchData);
  </script>
</body>
</html>
