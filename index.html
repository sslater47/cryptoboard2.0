<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Crypto Analyst Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 p-4">
  <h1 class="text-3xl font-bold mb-4 text-center">AI Crypto Analyst Dashboard</h1>
  <div class="flex justify-center mb-4">
    <button id="refreshBtn" class="bg-blue-500 text-white px-4 py-2 rounded">Refresh</button>
  </div>
  <div id="tracker" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>

  <script>
    const coins = [
      { id: 'crypto-com-chain', symbol: 'CRO', name: 'Cronos' },
      { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin' },
      { id: 'ripple', symbol: 'XRP', name: 'XRP' },
      { id: 'ethereum', symbol: 'ETH', name: 'Ethereum' },
      { id: 'cardano', symbol: 'ADA', name: 'Cardano' },
      { id: 'hedera-hashgraph', symbol: 'HBAR', name: 'Hedera' },
    ];
    const charts = {};

    async function fetchData() {
      const ids = coins.map(c => c.id).join('%2C');
      const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}&sparkline=true`;
      const res = await fetch(url);
      const data = await res.json();
      render(data);
    }

    function computePredictions(current, changePct) {
      const preds = [];
      for (let h = 1; h <= 24; h++) {
        const p = current * (1 + (changePct / 100) * (h / 24));
        preds.push(p.toFixed(4));
      }
      return preds;
    }

    function computeFearGreed(changePct) {
      const fg = Math.max(0, Math.min(100, 50 + changePct * 2));
      let label = 'Neutral';
      if (fg < 40) label = 'Fear';
      else if (fg > 60) label = 'Greed';
      return { value: fg.toFixed(0), label };
    }

    function render(data) {
      const container = document.getElementById('tracker');
      container.innerHTML = '';
      data.forEach(info => {
        const card = document.createElement('div');
        card.className = 'bg-white shadow p-4 rounded';
        const price = info.current_price.toFixed(4);
        const change = info.price_change_percentage_24h.toFixed(2);
        const preds = computePredictions(info.current_price, info.price_change_percentage_24h);
        const fg = computeFearGreed(info.price_change_percentage_24h);
        const action = change >= 0 ? 'Consider Buying' : 'Consider Selling';
        const predHTML = preds.map((p,i)=>`<div>${i+1}h: $${p}</div>`).join('');
        card.innerHTML = `
          <h2 class="text-xl font-semibold mb-2 flex items-center">
            <img src="${info.image}" alt="${info.symbol}" class="w-6 h-6 mr-2"/>
            ${info.name} (${info.symbol.toUpperCase()})
          </h2>
          <p>Price: $${price}</p>
          <p>Market Cap: $${Number(info.market_cap).toLocaleString()}</p>
          <p class="${change >= 0 ? 'text-green-600' : 'text-red-600'}">24h Change: ${change}%</p>
          <p>Action: ${action}</p>
          <p>Fear/Greed Index: ${fg.value} (${fg.label})</p>
          <div class="grid grid-cols-3 gap-1 text-xs mt-2">${predHTML}</div>
          <canvas id="chart-${info.id}" height="100" class="mt-2"></canvas>
        `;
        container.appendChild(card);
        const ctx = document.getElementById(`chart-${info.id}`).getContext('2d');
        if (!charts[info.id]) {
          charts[info.id] = new Chart(ctx, {
            type: 'line',
            data: {
              labels: info.sparkline_in_7d.price.map((_, i) => i),
              datasets: [{
                label: 'Live Price',
                data: info.sparkline_in_7d.price,
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
              }]
            },
            options: { scales: { x: { display: false } } }
          });
        } else {
          const chart = charts[info.id];
          chart.data.labels.push(chart.data.labels.length);
          chart.data.datasets[0].data.push(info.current_price);
          if (chart.data.datasets[0].data.length > 120) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
          }
          chart.update();
        }
      });
    }

    function mockPredict(price) {
      const p = parseFloat(price);
      const nextDay = (p * (1 + (Math.random() - 0.5) / 20)).toFixed(4);
      return `$${nextDay} in 24h (not financial advice)`;
    }

    document.getElementById('refreshBtn').addEventListener('click', fetchData);
    fetchData();
    setInterval(fetchData, 60000); // refresh every minute
  </script>
</body>
</html>
