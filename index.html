<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Crypto Analyst Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 p-4">
  <h1 class="text-3xl font-bold mb-4 text-center">AI Crypto Analyst Dashboard</h1>
  <div class="text-center mb-4">
    <button id="refresh" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Refresh</button>
  </div>
  <div id="tracker" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>

  <script>
    const coins = [
      { id: 'crypto-com-chain', symbol: 'CRO', name: 'Cronos' },
      { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin' },
      { id: 'ripple', symbol: 'XRP', name: 'XRP' },
      { id: 'ethereum', symbol: 'ETH', name: 'Ethereum' },
      { id: 'cardano', symbol: 'ADA', name: 'Cardano' },
      { id: 'hedera-hashgraph', symbol: 'HBAR', name: 'Hedera' },
    ];

    const charts = {};
    const liveData = {};
    let fngIndex = { value: '0', value_classification: 'Unknown' };

    async function fetchFearGreed() {
      try {
        const res = await fetch('https://api.alternative.me/fng/?limit=1');
        const data = await res.json();
        fngIndex = data.data[0];
      } catch (e) {
        console.error('F&G fetch error', e);
      }
    }

    async function fetchData() {
      const ids = coins.map(c => c.id).join('%2C');
      const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}`;
      const res = await fetch(url);
      const data = await res.json();
      render(data);
    }

    function render(data) {
      const container = document.getElementById('tracker');
      container.innerHTML = '';
      const now = new Date().toLocaleTimeString();
      data.forEach(info => {
        const card = document.createElement('div');
        card.className = 'bg-white shadow p-4 rounded';
        const price = info.current_price.toFixed(4);
        const change = info.price_change_percentage_24h.toFixed(2);
        const hourly = predictHourlyPrices(price);
        const advice = tradeAdvice(price, hourly[0]);
        const hourlyHtml = hourly.map((p,i) => `<div>${i+1}h: $${p}</div>`).join('');
        card.innerHTML = `
          <h2 class="text-xl font-semibold mb-2 flex items-center">
            <img src="${info.image}" alt="${info.symbol}" class="w-6 h-6 mr-2"/>
            ${info.name} (${info.symbol.toUpperCase()})
          </h2>
          <p>Price: $${price}</p>
          <p>Market Cap: $${Number(info.market_cap).toLocaleString()}</p>
          <p class="${change >= 0 ? 'text-green-600' : 'text-red-600'}">24h Change: ${change}%</p>
          <p class="mt-1 text-sm">Fear & Greed: ${fngIndex.value} (${fngIndex.value_classification})</p>
          <p class="font-semibold">Advice: ${advice}</p>
          <canvas id="live-${info.id}" height="100"></canvas>
          <div class="grid grid-cols-6 gap-1 text-xs mt-2">${hourlyHtml}</div>
        `;
        container.appendChild(card);

        if (!liveData[info.id]) {
          liveData[info.id] = { labels: [], prices: [] };
        }
        const ld = liveData[info.id];
        ld.labels.push(now);
        ld.prices.push(info.current_price);
        if (ld.labels.length > 60) {
          ld.labels.shift();
          ld.prices.shift();
        }

        const ctx = document.getElementById(`live-${info.id}`).getContext('2d');
        if (charts[info.id]) {
          charts[info.id].data.labels = ld.labels;
          charts[info.id].data.datasets[0].data = ld.prices;
          charts[info.id].update();
        } else {
          charts[info.id] = new Chart(ctx, {
            type: 'line',
            data: {
              labels: ld.labels,
              datasets: [{
                label: 'Live Price',
                data: ld.prices,
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
              }]
            },
            options: { scales: { x: { display: false } } }
          });
        }
      });
    }

    function predictHourlyPrices(price) {
      const preds = [];
      let p = parseFloat(price);
      for (let i = 0; i < 24; i++) {
        p = p * (1 + (Math.random() - 0.5) / 50);
        preds.push(p.toFixed(4));
      }
      return preds;
    }

    function tradeAdvice(current, nextHour) {
      const curr = parseFloat(current);
      const nxt = parseFloat(nextHour);
      if (nxt > curr * 1.01) return 'Buy';
      if (nxt < curr * 0.99) return 'Sell';
      return 'Hold';
    }

    document.getElementById('refresh').addEventListener('click', () => {
      fetchFearGreed();
      fetchData();
    });

    fetchFearGreed();
    fetchData();
    setInterval(() => { fetchFearGreed(); fetchData(); }, 60000);
  </script>
</body>
</html>
